<p-toast></p-toast>

<p-toolbar styleClass="mb-4">
  <ng-template pTemplate="left">
    <button pButton pRipple label="Ajouter un bénéficiaire" icon="pi pi-plus"
            class="p-button-primary" (click)="openNew()"></button>
  </ng-template>

  <ng-template pTemplate="right">
    <span class="p-input-icon-left w-full sm:w-20rem">
      <i class="pi pi-search"></i>
      <input pInputText type="text" (input)="onGlobalFilter(dt, $event)"
             placeholder="Rechercher..." class="w-full" />
    </span>
  </ng-template>
</p-toolbar>

<p-table
  #dt
  [value]="loading ? skeletonRows : beneficiaires"
  [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,20,30]"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="Liste {first} / {last}"
  responsiveLayout="scroll"
  dataKey="id"
  [globalFilterFields]="['nom_complet','phone']">

  <!-- En-têtes (desktop) -->
  <ng-template pTemplate="header">
    <tr class="show-desktop">
      <th pSortableColumn="nom_complet">Nom <p-sortIcon field="nom_complet"></p-sortIcon></th>
      <th pSortableColumn="phone">Téléphone <p-sortIcon field="phone"></p-sortIcon></th>
      <th class="text-center" style="width:10rem">Actions</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-b>
    <!-- Skeleton desktop -->
    <tr *ngIf="loading" class="show-desktop">
      <td><p-skeleton width="12rem" /></td>
      <td><p-skeleton width="10rem" /></td>
      <td class="text-center"><p-skeleton width="6rem" height="2rem" borderRadius="1rem" /></td>
    </tr>

    <!-- Ligne desktop -->
    <tr *ngIf="!loading" class="show-desktop">
      <td class="font-medium text-900">{{ b.nom_complet }}</td>
      <td>{{ b.phone | phoneFormat:'GN' }}</td>
      <td class="text-center">
        <div class="inline-flex gap-2">
          <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success"
                  (click)="editBeneficiaire(b)"></button>
          <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger"
                  (click)="deleteBeneficiaire(b)"></button>
        </div>
      </td>
    </tr>

    <!-- Carte mobile -->
    <tr class="show-mobile">
      <td colspan="3" class="p-0">
        <div class="mobile-card">
          <div class="flex align-items-center gap-3">
            <div class="avatar-initials">{{ getInitials(b.nom_complet) }}</div>
            <div>
              <div class="text-900 font-medium line-height-2">{{ b.nom_complet }}</div>
              <div class="text-600 text-sm">{{ b.phone | phoneFormat:'GN' }}</div>
            </div>
          </div>
          <div class="flex gap-2">
            <button pButton pRipple icon="pi pi-pencil"
                    class="p-button-rounded p-button-text p-button-success"
                    (click)="editBeneficiaire(b)"></button>
            <button pButton pRipple icon="pi pi-trash"
                    class="p-button-rounded p-button-text p-button-danger"
                    (click)="deleteBeneficiaire(b)"></button>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr><td colspan="3" class="text-center py-5">Aucun bénéficiaire</td></tr>
  </ng-template>
</p-table>
